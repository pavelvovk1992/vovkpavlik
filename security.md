#Основы веб-безопасности

###Угрозы безопасности сайта  

**Межсайтовый скриптинг (XSS)**  
XSS (Cross-Site Scripting - Межсайтовый скриптинг) это термин, используемый для описания типа атак, которые позволяют злоумышленнику внедрять вредоносный код через веб-сайт в браузеры других пользователей. Поскольку внедрённый код поступает в браузер с сайта, он является доверенным и может выполнять такие действия, как отправка авторизационного файла cookieпользователя злоумышленнику. Когда у злоумышленника есть файл cookie, он может войти на сайт, как если бы он был пользователем, и сделать все, что может пользователь, например, получить доступ к данным кредитной карты, просмотреть контактные данные или изменить пароли.  

Уязвимости XSS делятся на отражённые и хранимые, в зависимости от того, как сайт возвращает внедрённый код в браузер.

*Отражённая XSS-уязвимость* возникает, когда пользовательский контент, который передаётся на сервер, немедленно и без изменений возвращается для отображения в браузере. Любой скрипт в исходном пользовательском контенте запустится при загрузке новой страницы. Например, рассмотрим строку поиска по сайту, в которой поисковые слова закодированы как параметры URL, и эти слова отображаются вместе с результатами. Злоумышленник может создать поисковую ссылку, которая будет содержать вредоносный скрипт в качестве параметра (например: http://mysite.com?q=beer<script%20src="http://evilsite.com/tricky.js"></script>) и переслать его другому пользователю по электронной почте. Если целевой пользователь кликнет по этой «интересной ссылке», то скрипт выполнится при отображении результатов поиска. Как мы уже говорили, злоумышленник  таким образом получает всю информацию, необходимую ему для входа на сайт в качестве целевого пользователя, потенциального совершения покупок от имени пользователя или получения его контактной информации.  

*Постоянная уязвимость XSS* возникает, когда вредоносный скрипт хранится на веб-сайте, а затем снова отображается без изменений, чтобы другие пользователи могли выполнять его невольно.
Например, доска обсуждений, которая принимает комментарии, содержащие неизмененный HTML, может хранить вредоносный скрипт от злоумышленника. Когда комментарии отображаются, скрипт выполняется и может отправить злоумышленнику информацию, необходимую для доступа к учётной записи пользователя. Атака такого рода чрезвычайно популярна и мощна, потому что злоумышленник может даже не иметь прямого отношения к жертвам.

Наилучшей защитой от уязвимостей XSS является удаление или отключение любой разметки, которая потенциально может содержать инструкции по запуску кода. Для HTML это включает такие элементы, как `<script>, <object>, <embed> и <link>`.

Процесс изменения пользовательских данных, чтобы их нельзя было использовать для запуска сценариев или иным образом влиять на выполнение серверного кода, называется очисткой ввода. Многие веб-фреймворки автоматически очищают пользовательский ввод от HTML-форм по умолчанию.

**SQL injection**  
Уязвимости SQL-инъекций позволяют злоумышленникам выполнять произвольный код SQL в базе данных, позволяя получать, изменять или удалять данные независимо от разрешений пользователя. Успешная инъекционная атака может подделать удостоверения, создать новые удостоверения с правами администратора, получить доступ ко всем данным на сервере или уничтожить / изменить данные, чтобы сделать их непригодными для использования.

Типы внедрения SQL включают внедрение SQL на основе ошибок, внедрение SQL на основе логических ошибок и внедрение SQL на основе времени.

Эта уязвимость присутствует, если пользовательский ввод, который передаётся в базовый оператор SQL, может изменить смысл оператора. Например, следующий код предназначен для перечисления всех пользователей с определённым именем (userName), которое было предоставлено из формы HTML:  
```statement = "SELECT * FROM users WHERE name = '" + userName + "';"```

Если пользователь указывает реальное имя, оператор будет работать так, как задумано. Однако злонамеренный пользователь может полностью изменить поведение этого оператора SQL на новый оператор в следующем примере, просто указав текст полужирным шрифтом для userName.  
```SELECT * FROM users WHERE name = 'a';DROP TABLE users; SELECT * FROM userinfo WHERE 't' = 't';```

Модифицированный оператор создаёт действительный оператор SQL, который удаляет таблицу пользователей и выбирает все данные из таблицы userinfo (которая раскрывает информацию о каждом пользователе). Это работает, потому что первая часть введённого текста (a ';) завершает исходное утверждение.

Чтобы избежать такого рода атак, вы должны убедиться, что любые пользовательские данные, которые передаются в запрос SQL, не могут изменить природу запроса. Один из способов сделать это - экранировать все символы пользовательского ввода, которые имеют особое значение в SQL.

В следующей инструкции мы экранируем символ '. Теперь SQL будет интерпретировать имя как всю строку, выделенную жирным шрифтом (это действительно очень странное имя, но безопасное).  
```SELECT * FROM users WHERE name = 'a\';DROP TABLE users; SELECT * FROM userinfo WHERE \'t\' = \'t'```


**Подделка межсайтовых запросов (CSRF)**  
CSRF-атаки позволяют злоумышленнику выполнять действия, используя учётные данные другого пользователя, без его ведома или согласия.  

Этот тип атаки лучше всего пояснить на примере. Джон - злоумышленник, который знает, что определённый сайт позволяет пользователям, вошедшим в систему, отправлять деньги на указанную учётную запись, используя HTTP-запрос POST, который включает имя учётной записи и сумму денег. Джон создаёт форму, которая включает в себя его банковские реквизиты и сумму денег в виде скрытых полей, и отправляет её по электронной почте другим пользователям сайта (с кнопкой «Отправить», замаскированной под ссылку на сайт «быстрого обогащения»).

Если пользователь нажимает кнопку отправки, на сервер будет отправлен HTTP-запрос POST, содержащий сведения о транзакции и любые файлы cookie на стороне клиента, которые браузер связал с сайтом (добавление связанных файлов cookie сайта в запросы является нормальным поведением браузера). Сервер проверит файлы cookie и использует их, чтобы определить, вошёл ли пользователь в систему и имеет ли разрешение на совершение транзакции.

В результате любой пользователь, который нажимает кнопку Отправить во время входа на торговый сайт, совершает транзакцию. 

Один из способов предотвратить этот тип атаки - запросить сервером запросы POST, содержащие секрет, созданный пользователем для конкретного сайта. Секрет будет предоставлен сервером при отправке веб-формы, используемой для переводов. Такой подход не позволяет хаккеру создать свою собственную форму, потому что он должен знать секрет, который сервер предоставляет пользователю. Даже если он узнает секрет и создаст форму для конкретного пользователя, он больше не сможет использовать ту же форму для атаки на каждого пользователя.

Веб-фреймворки часто включают такие механизмы предотвращения CSRF.

**Clickjacking**  
 В этой атаке злоумышленник перехватывает клики, предназначенные для видимого сайта верхнего уровня, и направляет их на скрытую ниже страницу. Этот метод можно использовать, например, для отображения законного сайта банка, но захвата учётных данных для входа в невидимый `<iframe> (en-US)`, контролируемый злоумышленником. Clickjacking также можно использовать для того, чтобы заставить пользователя нажать кнопку на видимом сайте, но при этом на самом деле невольно нажимать совершенно другую кнопку. В качестве защиты ваш сайт может предотвратить встраивание себя в iframe на другом сайте, установив соответствующие заголовки HTTP.

_________________________________________________________  

###Протоколы безопасноти  

**Content Security Policy (CSP)**  
Content Security Policy (CSP) - это дополнительный уровень безопасности, позволяющий распознавать и устранять определённые типы атак, таких как Cross Site Scripting (XSS (en-US)) и атаки внедрения данных. Спектр применения этих атак включает, но не ограничивается кражей данных, подменой страниц и распространением зловредного ПО.  

Настройка  CSP включает в себя добавление на страницу HTTP-заголовка Content-Security-Policy (en-US) и его настройку в соответствии со списком доверенных источников, из которых пользователь может получать контент. Например, страница, на которой происходит загрузка и отображение изображений может разрешать их получение из любых источников, но ограничить отправку данных формы конкретным адресом. При правильной настройке, Content Security Policy поможет защитить страницу от атак межсайтового скриптинга.  


**Transport Layer Security(TLS)**  
TLS (Transport Layer Security) представляет собой стандартный протокол, который используется в целях создания защищенных онлайн-соединений или во внутренних сетях предприятий. Он дает возможность клиентам проводить проверку подлинности серверов. Серверы же с его помощью выполняют проверку подлинности клиентов (когда это важно). Протокол TLS также позволяет создать защищенный канал с помощью кодирования всех передаваемых данных.  

Протокол TLS может применяться для защиты соединений почти по всем популярным интернет-протоколам. К примеру, протокол https — это интернет-соединение по http, которое защищено по протоколу TLS. Также по протоколу TLS могут защищаться соединения по FTP, IMAP, POP3 и SMTP и т.д.  

 _____________________________________________________________________

###Цели и методы информационной безопасности 

Основные цели достижения высокого уровня информационной безопасности – это обеспечение конфиденциальности, целостности и доступности информации.

**Конфиденциальность**  
Конфиденциальность – это состояние доступности информации только авторизованным пользователям, процессам и устройствам.

**Целостность**  
Целостность – это отсутствие неправомочных искажений, добавлений или уничтожения информации. Гарантия целостности особенно важна в тех случаях, когда информация представляет большую ценность и не должна быть потеряна, а также когда данные могут быть намеренно изменены в целях дезинформации получателя. Как правило, от стирания информацию защищают методами, обеспечивающими конфиденциальность, и резервным копированием, а отсутствие искажений проверяют с помощью хеширования.

**Доступность**  
Доступность – это обеспечение своевременного и надежного доступа к информации и информационным сервисам. Типичными случаями нарушения доступности являются сбой в работе программных/аппаратных средств и распределенная атака типа «отказ в обслуживании» (DDoS). От сбоев информационную систему защищают устранением причин сбоев, а от DDoS-атак – отсечением паразитного трафика.

____________________________________________________________________
###Популярные способы защиты  
Простые методики защиты приложения от хакеров не требуют серьезных финансовых вливаний и доступны большинству владельцев интернет-магазинов и аналогичных ресурсов.

Среди них самые популярные:  
- аудит (превентивная мера);
- использование защищенных протоколов передачи данных;
- применение ПО, обеспечивающего безопасность.

Все способы необходимо применять в комплексе.

**Проверка сайта на уязвимости**  
Проверка проводится ручным или автоматизированным способом. Программы, доступные в платной и бесплатной версиях, протестируют приложение на основные риски. Такие программные продукты существуют в двух вариантах: Black hat, моделирующие действия взломщиков, и White hat, планомерно выявляющие все недочеты системы методом сканирования.

Среди самых эффективных бесплатных инструментов-приложений следует назвать:  
- __OpenVAS__ сканирует локальные сети на уязвимости; 
- __OWASP Xenotix XSS Exploit Framework__ проверяет сайт на XSS-уязвимость, – возможность внедрения в веб-страницу вредоносного кода, похищающего данные аккаунтов пользователей и иную информацию. Код внедряется через уязвимости на сервере или устройстве пользователя;
- __Approof от Positive Technologies__ изучает конфигурацию веб-приложения и находит лишний или вредоносный код.

Также с аудитом справятся бесплатные онлайн-сервисы.

После исправления серьезных уязвимостей сканирование следует провести повторно. Закончив автоматическую проверку, можно организовать взлом веб-приложения вручную. Для этого нужно изменить значение запросов POST (отправка данных на ресурс) и GET (запрос данных у ресурса) в HTTP. Лучше использовать прокси-сервер, перехватывающий HTTP-запросы. Также необходимо обойти валидацию данных (проверку соответствия запроса заданным требованиям) и внедрить на сайт SSL-инфекцию, перехватывающую данные пользователей. Если системы мониторинга показывают существенные уязвимости, необходимо усиливать защиту в выявленных областях.

Используя платные или бесплатные ресурсы мониторинга систем безопасности необходимо проверить гипотетическую возможность хакера обойти требования обязательной аутентификации, предусмотренные для некоторых страниц веб-приложения. Для этого нужно использовать такие традиционные способы взлома как смена параметров URL (в частности, ID пользователя) или смена Cookie.

**HTTPS**  
Вторым по популярности способом защитить данные пользователя после идентификации является применение защищенного протокола передачи данных HTTPS. Hyper Text Transfer Protocol Secure защищает информацию о пользователе веб-приложения при помощи шифрования трафика. Он обеспечивает сохранение конфиденциальности и целостности информации, не допуская утечку или подмену данных. 

Большинство ресурсов использует технологию давно, это стало хорошим тоном, подтверждающим готовность их владельцев защищать интересы клиентов. Поисковик Google поднимает в выдаче сайты, использующие эту технологию.

HTTPS необходим, если пользователи передают сервису такие сведения, как:  
- _номера кредитных карт_;
- _персональные данные_;
- _адреса страниц, на которые они заходят_.

При генерации запроса с формы авторизации применяются cookie-файлы, они подлежат отправке на сервер при каждом запросе. При слабой защите веб-приложения ничего не мешает злоумышленнику перехватить файлы и подделать запрос, получив права пользователя. Применение HTTPS для каждой страницы сайта снизит степень этого риска.

Для решения задачи потребуются следующие шаги:  
- сгененировать SSL-сертификат, на некоторых ресурсах это делается бесплатно;
- получить и установить сертификат;
- подключить для веб-приложения поддержку HTTPS.

**Обновление ПО**  
В ситуации, когда сервис установлен на чужом хостинге, задача своевременной замены операционной системы ложится на плечи провайдера. Если хостинг собственный, ОС требуется менять сразу после выхода обновлений. Сайт может работать на операционной системе, предназначенной для этого типа веб-приложений (движка), стороннего производителя, особенно это характерно для интернет-магазинов. Необходимо отслеживать все обновления ПО и устанавливать новую версию сразу после ее выхода. Разработчики оповестят об этом владельца ресурса рассылкой, а наиболее популярные авторы движков, WordPress и Umbraco, сообщают об обновлениях в момент входа в панель управления сайтом.

Web-сайты часто имеют зависимые компоненты (программные модули менеджмента контента). Для управления ими используются менеджеры пакетов, например, Composer, NPM или RubyGems. За их обновлениями во избежание проблем безопасности также необходимо следить.

**Защита от SQL-инъекций**  
Безопасность веб-приложения зависит от того, насколько эффективно владельцу удается избежать SQL-инъекций. Этот метод хакерской атаки выглядит как запрос к сайту и его базе данных при помощи поля формы или параметра URL. Если при конструировании ресурса применялся язык Transact SQL, в запрос вставляется вредоносный код, с легкостью меняющий или уничтожающий данные, содержащиеся в таблицах.

Избежать риска получится, если применять параметризованные запросы, в которых задействовано несколько языков программирования.

**Дополнительные способы обеспечения безопасности**  
Работа с веб-сервисами требует использования широкого инструментария для обеспечения безопасности. Помимо основных перечисленных методов, часто применяются:  
- шифрование паролей;
- избегание межсайтового скриптинга;
- контроль загрузки файлов на сервер.

Совместное применение всех доступных решений обеспечит безопасность на максимально доступном уровне. 

___________________________________________________________________________________________________________________

##Безопасность веб-приложения Django

###Защита от межсайтового скриптинга (XSS)
Система шаблонов Django защищает от большинства XSS-атак,  экранируя определённые символы, считающиеся "опасными" в HTML.  
Использование шаблонов Django защищает вас от большинства XSS-атак. Однако существует возможность отключения данной защиты, при котором экранирование не будет автоматически применятся ко всем полям, которые не должны будут заполнятся пользователем(к примеру, поле help_text обычно заполняется не пользователем, поэтому Django не будет экранировать его значение).

Так же XSS-атаки могут быть осуществлены через другие ненадёжные источники данных, такие как cookies, сторонние сервисы или загруженные файлы (и прочие источники, данные которых не были специально обработаны перед отображением на странице). Если вы отображаете данные из этих источников, вы должны добавить ваш собственный обработчик для фильтрации данных.

###Защита от межсайтовой подделки запроса (CSRF)  
CSRF атаки позволяют атакующему выполнять действия от имени другого пользователя без его согласия. 

Для того, чтобы сделать это, хакер может создать HTML файл, который будет содержать форму создания автора, которая будет отправлена как только данный файл будет загружен в браузер. Хакер отправит данный файл всем Библиотекарям и будет ждать пока кто-либо из них откроет файл. Если файл будет открыт любым залогиненным пользователем, с правами Библиотекаря - тогда форма будет  отправлена от его имени и создаст нового пользователя.

Механизм защиты заключается в том, что вы добавляете тег шаблона {% csrf_token %} в вашу форму. Этот токен будет отображён в вашем HTML как показано ниже, со значением, уникальным для каждого запрашивающего форму пользователя.

Django генерирует уникальный для пользователя/браузера токен и отклоняет все формы, которые не содержат его или содержат его неверное значение.

Для продолжения использования данного вида атак, хакер теперь должен найти и добавить верный CSRF токен для каждого выбранного целью пользователя. Это означает, что хакер теперь не может использовать массовые рассылки одного вредоносного файла всем Библиотекарям, так как для каждого из них CSRF токен будет уникальным.

Защита Django от CSRF атак по умолчанию включена. Вам всегда следует использовать тег{% csrf_token %} в ваших формах и использовать POST для запросов, которые могут изменить или добавить данные в вашу базу данных.

###Защита от Кликджекинга

В данном виде атак атакующий перехватывает ввод на видимом слое страницы и перенаправляет их на скрытый слой под ним. Этот метод может быть использован к примеру для отображения официального сайта банка, с перехватом данных для входа в невидимом  `<iframe>`, который контролирует атакующий. Django содержит защиту от кликджекинга в виде промежуточного програмного обеспечения (middleware) X-Frame-Options, который поддерживается браузерами и может запретить отображение страницы внутри `<iframe>`.




